<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrimeSmsHub Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f8f9fa;color:#333}
.header{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:15px 20px;box-shadow:0 2px 8px rgba(0,0,0,.1);position:sticky;top:0;z-index:100}
.header .logo img{width:120px}
.header-right{display:flex;align-items:center;gap:15px}
.menu-icon{font-size:24px;cursor:pointer;display:none}
.wallet-btn{background:#0024ff;color:#fff;padding:10px 15px;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:14px}
.wallet-btn:hover{background:#0020cc}

.sidebar{position:fixed;top:0;left:0;width:280px;height:100vh;background:#fff;box-shadow:2px 0 10px rgba(0,0,0,.08);transform:translateX(0);transition:.3s;z-index:2000;overflow-y:auto;padding-top:10px}
.sidebar.open{transform:translateX(0)}
.sidebar .close-btn{display:none;font-size:24px;cursor:pointer;padding:10px 20px;color:#333}
.sidebar .close-btn.show{display:block}
.sidebar nav ul{list-style:none}
.sidebar nav li{margin:5px 0}
.sidebar nav a{display:flex;align-items:center;gap:12px;padding:12px 20px;color:#333;text-decoration:none;transition:.2s;font-weight:500}
.sidebar nav a:hover{background:#f0f4ff;color:#0024ff;border-left:3px solid #0024ff;padding-left:17px}
.sidebar .badge{background:#e9eefc;color:#0024ff;padding:2px 8px;border-radius:12px;font-size:12px;margin-left:auto}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;visibility:hidden;transition:.2s;z-index:1500}
.overlay.show{opacity:1;visibility:visible}

.container{padding:20px;margin-left:280px;transition:.3s}
.container.sidebar-open{margin-left:280px}

.hero{background:linear-gradient(135deg,#0024ff 0%,#0047cc 100%);color:#fff;padding:40px 20px;border-radius:8px;margin-bottom:30px;text-align:center}
.hero h1{font-size:28px;margin-bottom:10px;font-weight:700}
.hero p{font-size:16px;opacity:.95;margin-bottom:20px}
.hero .wallet-amount{font-size:36px;font-weight:700;margin:20px 0}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px}

.card{background:#fff;padding:25px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.08);transition:.3s}
.card:hover{box-shadow:0 4px 16px rgba(0,0,0,.12)}
.card h3{font-size:18px;margin-bottom:15px;color:#0024ff;font-weight:600}

.form-group{margin-bottom:15px}
.form-group label{display:block;font-weight:600;margin-bottom:5px;font-size:14px}
.form-group input,.form-group select{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;transition:.2s;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
.form-group input:focus,.form-group select:focus{outline:none;border-color:#0024ff;box-shadow:0 0 5px rgba(0,36,255,.1)}

.btn{background:#0024ff;color:#fff;padding:12px 20px;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:14px;transition:.2s;width:100%}
.btn:hover{background:#0020cc}
.btn:active{transform:scale(.98)}

.transactions{background:#fff;padding:25px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.08);margin-bottom:30px}
.transactions h3{color:#0024ff;margin-bottom:20px;font-weight:600}
.tx-list{max-height:400px;overflow-y:auto}
.tx-item{display:flex;justify-content:space-between;align-items:center;padding:15px;border-bottom:1px solid #eee;font-size:14px}
.tx-item:last-child{border-bottom:none}
.tx-item .amount{font-weight:600;color:#0024ff}
.tx-item .date{color:#999;font-size:13px}

.features{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:30px}
.feature-card{background:#fff;padding:20px;border-radius:8px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.feature-card .icon{font-size:32px;margin-bottom:10px}
.feature-card h4{font-size:14px;font-weight:600;color:#333;margin-bottom:5px}
.feature-card p{font-size:12px;color:#999}

@media(max-width:768px){
  .container{padding:15px;margin-left:0}
  .header-right{gap:10px}
  .menu-icon{display:block}
  .sidebar{transform:translateX(-100%)}
  .container.sidebar-open{margin-left:0}
  .grid{grid-template-columns:1fr}
  .hero h1{font-size:24px}
  .hero .wallet-amount{font-size:28px}
  .wallet-btn{padding:8px 12px;font-size:12px}
}

::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}
::-webkit-scrollbar-thumb{background:#0024ff;border-radius:10px}
::-webkit-scrollbar-thumb:hover{background:#0020cc}
</style>
</head>

<body>

<div class="header">
  <div class="menu-icon" id="menuIcon">â˜°</div>
  <div class="logo"><img src="hero.png" alt="PrimeSmsHub"></div>
  <div class="header-right">
    <button class="wallet-btn" id="walletBtn">Wallet: $0.00</button>
  </div>
</div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="close-btn" id="closeBtn">âœ•</div>
  <nav>
    <ul>
      <li><a href="dashboard.html"><span>ğŸ </span>Dashboard</a></li>
      <li><a href="buy-numbers.html"><span>ğŸ“±</span>Buy Numbers</a></li>
      <li><a href="usa-numbers.html"><span>ğŸ‡ºğŸ‡¸</span>USA Numbers</a></li>
      <li><a href="my-orders.html"><span>ğŸ“¦</span>My Orders <span class="badge">0</span></a></li>
      <li><a href="transactions.html"><span>ğŸ’³</span>My Transactions <span class="badge" id="txCount">0</span></a></li>
      <li><a href="support.html"><span>â“</span>Support</a></li>
      <li><a href="#" id="logoutBtn"><span>ğŸšª</span>Logout</a></li>
    </ul>
  </nav>
</aside>

<div class="overlay" id="overlay"></div>

<!-- MAIN CONTENT -->
<div class="container" id="container">
  <!-- HERO SECTION -->
  <div class="hero">
    <h1>Welcome to PrimeSmsHub</h1>
    <p>Verify more for less with virtual phone numbers</p>
    <div class="wallet-amount" id="walletAmount">$0.00</div>
    <p style="font-size:14px;opacity:.9">Current Wallet Balance</p>
  </div>

  <!-- FEATURES -->
  <div class="features">
    <div class="feature-card">
      <div class="icon">ğŸ”’</div>
      <h4>Secure</h4>
      <p>Protected transactions</p>
    </div>
    <div class="feature-card">
      <div class="icon">âš¡</div>
      <h4>Instant</h4>
      <p>Immediate activation</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸ’°</div>
      <h4>Affordable</h4>
      <p>Best prices</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸŒ</div>
      <h4>Global</h4>
      <p>Multiple countries</p>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid">
    <!-- FUND WALLET CARD -->
    <div class="card">
      <h3>ğŸ’³ Fund Your Wallet</h3>
      <form id="fundForm">
        <div class="form-group">
          <label for="amount">Amount (USD)</label>
          <input type="number" id="amount" placeholder="Enter amount" min="1" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="currency">Currency</label>
          <select id="currency" required>
            <option value="NGN">ğŸ‡³ğŸ‡¬ Nigerian Naira (NGN)</option>
            <option value="GHS">ğŸ‡¬ğŸ‡­ Ghanaian Cedi (GHS)</option>
            <option value="KES">ğŸ‡°ğŸ‡ª Kenyan Shilling (KES)</option>
            <option value="ZAR">ğŸ‡¿ğŸ‡¦ South African Rand (ZAR)</option>
            <option value="USD" selected>ğŸ‡ºğŸ‡¸ US Dollar (USD)</option>
            <option value="ZMW">ğŸ‡¿ğŸ‡² Zambian Kwacha (ZMW)</option>
            <option value="EGP">ğŸ‡ªğŸ‡¬ Egyptian Pound (EGP)</option>
            <option value="RWF">ğŸ‡·ğŸ‡¼ Rwandan Franc (RWF)</option>
            <option value="UGX">ğŸ‡ºğŸ‡¬ Ugandan Shilling (UGX)</option>
            <option value="TZS">ğŸ‡¹ğŸ‡¿ Tanzanian Shilling (TZS)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="phoneNumber">Phone Number</label>
          <input type="tel" id="phoneNumber" placeholder="Your phone number" required>
        </div>
        <button type="button" class="btn" id="payBtn">Proceed to Payment</button>
      </form>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="card">
      <h3>ğŸš€ Quick Actions</h3>
      <button class="btn" id="buyNumberBtn" style="margin-bottom:10px;background:#28a745">Buy Number Now</button>
      <button class="btn" id="pricingBtn" style="margin-bottom:10px;background:#17a2b8">View Pricing</button>
      <button class="btn" id="supportBtn" style="background:#6c757d">Contact Support</button>
    </div>
  </div>

  <!-- TRANSACTIONS SECTION -->
  <div class="transactions">
    <h3>ğŸ“Š Recent Transactions</h3>
    <div class="tx-list" id="txList">
      <div style="text-align:center;padding:30px;color:#999">No transactions yet</div>
    </div>
  </div>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import {
  getFirestore, doc, getDoc, setDoc, updateDoc,
  collection, addDoc, query, where, getDocs, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCIK3C5qAOUZUtUixX1knFRSkXAYXOCDaA",
  authDomain: "primesmshub-c0f58.firebaseapp.com",
  projectId: "primesmshub-c0f58"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const BACKEND_URL = "https://smshub-ftgg.onrender.com";

/* DOM */
const $ = id => document.getElementById(id);
const menuIcon=$("menuIcon"), sidebar=$("sidebar"), overlay=$("overlay"), closeBtn=$("closeBtn");
const container=$("container"), walletBtn=$("walletBtn"), walletAmount=$("walletAmount");
const amountInput=$("amount"), phoneInput=$("phoneNumber"), payBtn=$("payBtn");
const currencyInput=$("currency"), txList=$("txList"), txCount=$("txCount"), logoutBtn=$("logoutBtn");
const buyNumberBtn=$("buyNumberBtn"), pricingBtn=$("pricingBtn"), supportBtn=$("supportBtn");

/* UI - SIDEBAR TOGGLE */
menuIcon.onclick=()=>{
  sidebar.classList.add("open");
  overlay.classList.add("show");
  closeBtn.classList.add("show");
};

closeBtn.onclick=overlay.onclick=()=>{
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
  closeBtn.classList.remove("show");
};

/* Close sidebar on link click */
sidebar.querySelectorAll("a").forEach(link=>{
  link.onclick=()=>{
    sidebar.classList.remove("open");
    overlay.classList.remove("show");
    closeBtn.classList.remove("show");
  };
});

/* QUICK ACTION BUTTONS */
buyNumberBtn.onclick=()=>location.href="buy-numbers.html";
pricingBtn.onclick=()=>location.href="usa-numbers.html";
supportBtn.onclick=()=>location.href="support.html";

/* AUTH */
let currentUser;
onAuthStateChanged(auth, async user=>{
  if(!user) return location.href="login.html";
  currentUser=user;

  const ref=doc(db,"users",user.uid);
  if(!(await getDoc(ref)).exists())
    await setDoc(ref,{email:user.email,wallet:0,createdAt:serverTimestamp()});

  loadPaystackKey();
  refreshWallet();
  loadTransactions();
});

/* WALLET */
async function refreshWallet(){
  const snap=await getDoc(doc(db,"users",currentUser.uid));
  const balance=(snap.data().wallet||0).toFixed(2);
  walletBtn.innerText=`Wallet: $${balance}`;
  walletAmount.innerText=`$${balance}`;
}

/* PAYSTACK PAYMENT (ALL TYPES ENABLED) */
let paystackPublicKey='pk_live_639470fbe710a9b3503068dd875e4b027bd096fe';

async function loadPaystackKey(){
  try{
    const res=await fetch(`${BACKEND_URL}/paystack-public-key`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data=await res.json();
    if(data.publicKey){
      paystackPublicKey=data.publicKey;
      console.log('Paystack public key loaded from server:', paystackPublicKey);
    }
  }catch(e){
    console.warn('Failed to load Paystack key from server, using fallback:', e);
  }
}

payBtn.onclick=()=>{
  const amount=Number(amountInput.value);
  const phone=phoneInput.value.trim();
  const currency=currencyInput.value;
  if(!amount||!phone||!currency) return alert("Fill all fields");

  const handler=PaystackPop.setup({
    key:paystackPublicKey,
    email:currentUser.email,
    amount:amount*100,
    currency:currency,
    ref:"PSH-"+crypto.randomUUID(),
    onClose:()=>alert("Payment window closed"),
    onSuccess:data=>verifyPayment(data.reference,amount,currency)
  });
  handler.openIframe();
};

async function verifyPayment(txId,amount,currency){
  payBtn.disabled=true;
  payBtn.innerText="Processing...";
  
  try{
    const res=await fetch(`${BACKEND_URL}/paystack/verify/${txId}`);
    const data=await res.json();
    if(data.status!=="success") return alert("Payment failed");

    const ref=doc(db,"users",currentUser.uid);
    const snap=await getDoc(ref);
    const newWallet=(snap.data().wallet||0)+amount;
    
    await updateDoc(ref,{wallet:newWallet});
    
    await addDoc(collection(db,"transactions"),{
      uid:currentUser.uid,
      amount,
      currency,
      txId,
      createdAt:serverTimestamp()
    });

    walletAmount.innerText=`$${newWallet.toFixed(2)}`;
    walletBtn.innerText=`Wallet: $${newWallet.toFixed(2)}`;
    
    alert("âœ… Wallet funded successfully with "+amount+" "+currency);
    
    amountInput.value="";
    phoneInput.value="";
    currencyInput.value="USD";
    
    loadTransactions();
  }catch(e){
    console.error('Payment verification error:', e);
    alert("Error processing payment: "+e.message);
  }finally{
    payBtn.disabled=false;
    payBtn.innerText="Proceed to Payment";
  }
}

/* TRANSACTIONS */
async function loadTransactions(){
  const q=query(collection(db,"transactions"),where("uid","==",currentUser.uid));
  const snap=await getDocs(q);
  txList.innerHTML="";
  txCount.innerText=snap.size;
  
  if(snap.size===0){
    txList.innerHTML=`<div style="text-align:center;padding:30px;color:#999">No transactions yet</div>`;
    return;
  }
  
  snap.forEach(d=>{
    const t=d.data();
    const date=new Date(t.createdAt?.toDate()).toLocaleDateString();
    txList.innerHTML+=`
      <div class="tx-item">
        <div>
          <div style="font-weight:600">Payment Received</div>
          <div class="date">${date}</div>
        </div>
        <div class="amount">+$${t.amount}</div>
      </div>
    `;
  });
}

logoutBtn.onclick=()=>signOut(auth);
</script>

</body>
</html>
